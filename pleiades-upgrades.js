// Pleiades OS Functional Upgrades - Core Systems
const CommandPalette={isOpen:!1,selectedIndex:0,recentCommands:[],currentQuery:"",commands:[{id:"nav-dashboard",type:"nav",label:"Go to Dashboard",icon:"‚ú®",shortcut:"G D",action:()=>switchTab("dashboard")},{id:"nav-projects",type:"nav",label:"Go to Path",icon:"üéØ",shortcut:"G P",action:()=>switchTab("projects")},{id:"nav-command",type:"nav",label:"Go to Command",icon:"üåü",shortcut:"G C",action:()=>switchTab("command")},{id:"nav-meetings",type:"nav",label:"Go to Rituals",icon:"üìû",shortcut:"G R",action:()=>switchTab("meetings")},{id:"nav-intel",type:"nav",label:"Go to Signals",icon:"üì°",shortcut:"G S",action:()=>switchTab("intel")},{id:"nav-llm",type:"nav",label:"Go to LLM",icon:"ü§ñ",shortcut:"G L",action:()=>switchTab("llm")},{id:"nav-brain",type:"nav",label:"Go to Brain",icon:"üß†",shortcut:"G B",action:()=>switchTab("brain")},{id:"nav-timeline",type:"nav",label:"Go to Journey",icon:"üåô",shortcut:"G J",action:()=>switchTab("timeline")},{id:"nav-notes",type:"nav",label:"Go to Notes",icon:"üìù",shortcut:"G N",action:()=>switchTab("notes")},{id:"act-task",type:"action",label:"Add Task",icon:"üéØ",shortcut:"A T",action:()=>{closeCommandPalette(),addTask("backlog")}},{id:"act-priority",type:"action",label:"Add Priority",icon:"‚≠ê",shortcut:"A P",action:()=>{closeCommandPalette(),addPriority()}},{id:"act-meeting",type:"action",label:"Add Meeting",icon:"üìû",shortcut:"A M",action:()=>{closeCommandPalette(),addMeeting()}},{id:"act-intel",type:"action",label:"Add Intel",icon:"üì°",shortcut:"A I",action:()=>{closeCommandPalette(),addIntel()}},{id:"act-decision",type:"action",label:"Log Decision",icon:"üìã",shortcut:"A D",action:()=>{closeCommandPalette(),addDecision()}},{id:"act-note",type:"action",label:"Quick Note",icon:"üìù",shortcut:"A N",action:()=>{closeCommandPalette(),quickNote()}},{id:"sys-export",type:"system",label:"Export Data",icon:"üíæ",shortcut:"E D",action:()=>{exportAllData(),closeCommandPalette()}}],init(){this.recentCommands=S.get("po_recent_commands",[]),this.createPalette(),this.bindKeys()},createPalette(){if(document.getElementById("commandPalette"))return;let e=document.createElement("div");e.id="commandPalette",e.className="modal-overlay",e.style.cssText="display:none;z-index:5000;",e.innerHTML='<div class="modal" style="max-width:600px;padding:0;overflow:hidden;"><div style="padding:1rem 1.25rem;border-bottom:1px solid var(--border-subtle);display:flex;align-items:center;gap:.75rem;"><span style="font-size:1.1rem;color:var(--text-muted);">‚åò</span><input type="text" id="paletteInput" placeholder="Type a command..." style="flex:1;border:none;background:transparent;font-size:1rem;color:var(--text-primary);outline:none;font-family:var(--font-ui);"><span style="font-size:.75rem;color:var(--text-muted);background:var(--color-warm);padding:.25rem .5rem;border-radius:4px;">ESC</span></div><div id="paletteResults" style="max-height:400px;overflow-y:auto;padding:.5rem 0;"></div></div>',document.body.appendChild(e),e.addEventListener("click",e=>{e.target===e&&this.close()}),document.getElementById("paletteInput").addEventListener("input",e=>this.handleInput(e.target.value)),document.getElementById("paletteInput").addEventListener("keydown",e=>this.handleKeydown(e))},bindKeys(){document.addEventListener("keydown",e=>{(e.metaKey||e.ctrlKey)&&"k"===e.key&&(e.preventDefault(),this.open()),"Escape"===e.key&&this.isOpen&&this.close()})},open(){this.isOpen=!0,this.selectedIndex=0,this.currentQuery="",document.getElementById("commandPalette").style.display="flex",document.getElementById("paletteInput").value="",document.getElementById("paletteInput").focus(),this.renderResults()},close(){this.isOpen=!1,document.getElementById("commandPalette").style.display="none"},handleInput(e){this.currentQuery=e.toLowerCase(),this.selectedIndex=0,this.renderResults()},handleKeydown(e){let t=this.getFilteredResults();switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex=(this.selectedIndex+1)%t.length,this.renderResults();break;case"ArrowUp":e.preventDefault(),this.selectedIndex=(this.selectedIndex-1+t.length)%t.length,this.renderResults();break;case"Enter":e.preventDefault(),t[this.selectedIndex]&&this.execute(t[this.selectedIndex])}},getFilteredResults(){if(!this.currentQuery){let e=this.recentCommands.map(e=>this.commands.find(t=>t.id===e)).filter(Boolean),t=this.commands.filter(e=>!this.recentCommands.includes(e.id));return[...e,...t]}return this.commands.filter(e=>this.fuzzyMatch((e.label+" "+e.shortcut).toLowerCase(),this.currentQuery))},fuzzyMatch(e,t){let a=0,n=0;for(;a<e.length&&n<t.length;)e[a]===t[n]&&n++,a++;return n===t.length},renderResults(){let e=document.getElementById("paletteResults"),t=this.getFilteredResults();if(0===t.length){e.innerHTML='<div style="padding:2rem;text-align:center;color:var(--text-muted);">No commands found</div>';return}let a=t.reduce((e,t)=>(e[t.type]||(e[t.type]=[]),e[t.type].push(t),e),{}),n={nav:"Navigation",action:"Actions",system:"System"},s="",i=0;Object.entries(a).forEach(([e,t])=>{s+=`<div style="padding:.5rem 1.25rem;font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);background:rgba(212,168,75,.05);">${n[e]}</div>`,t.forEach(e=>{let t=i===this.selectedIndex;s+=`<div onclick="CommandPalette.executeById('${e.id}')" style="padding:.75rem 1.25rem;display:flex;align-items:center;gap:.75rem;cursor:pointer;${t?"background:rgba(212,168,75,.15);":""}"><span style="font-size:1.1rem;">${e.icon}</span><span style="flex:1;font-weight:500;">${e.label}</span><span style="font-size:.75rem;color:var(--text-muted);background:var(--color-warm);padding:.15rem .4rem;border-radius:4px;">${e.shortcut}</span></div>`,i++})}),e.innerHTML=s;let l=e.querySelector('div[style*="background:rgba(212,168,75,.15)"]')||e.children[1];l&&l.scrollIntoView({block:"nearest"})},executeById(e){let t=this.commands.find(t=>t.id===e);t&&this.execute(t)},execute(e){this.recentCommands=[e.id,...this.recentCommands.filter(t=>t!==e.id)].slice(0,5),S.set("po_recent_commands",this.recentCommands),e.action(),this.close(),logAct(e.icon,"system",`Command: ${e.label}`)}};function openCommandPalette(){CommandPalette.open()}function closeCommandPalette(){CommandPalette.close()}function quickNote(){let e=prompt("Quick note:");if(e){let t=S.get("notes","");S.set("notes",t+"\n\n"+new Date().toLocaleString()+": "+e),toast("Note added"),logAct("üìù","note","Added quick note")}}function exportAllData(){let e={tasks:getTasks(),priorities:getPriorities(),meetings:getMeetings(),intel:getIntel(),agents:getAgents(),decisions:getDecisions(),timeline:getTimeline(),constellation:getConstellation(),notes:S.get("notes",""),exportedAt:new Date().toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=`pleiades-export-${todayStr()}.json`,a.click(),toast("Data exported"),logAct("üíæ","system","Exported all data")}

const SmartSort={parseDate(e){if(!e)return null;let t=new Date(e);return isNaN(t.getTime())?null:t},extractDateFromText(e){if(!e)return null;let t=[/due\s+(\w+\s+\d{1,2})/i,/by\s+(\w+\s+\d{1,2})/i,/(\d{4}-\d{2}-\d{2})/,/(\d{2}\/\d{2}\/\d{4})/];for(let a of t){let t=e.match(a);if(t){let e=new Date(t[1]);if(!isNaN(e.getTime()))return e}}return null},getUrgencyScore(e){let t=0,a=this.parseDate(e.date||e.due||e.deadline);!a&&e.text&&(a=this.extractDateFromText(e.text)),!a&&e.title&&(a=this.extractDateFromText(e.title)),!a&&e.description&&(a=this.extractDateFromText(e.description));if(a){let e=Math.ceil((a-new Date)/864e5);t+=e<0?100:0===e?90:1===e?80:e<=3?70:e<=7?50:e<=14?30:e<=30?15:0}return"urgent"===e.tag||"high"===e.priority?t+=25:"important"===e.tag||"medium"===e.priority?t+=15:"low"===e.priority&&(t+=5),"inprogress"===e.status&&(t+=10),Math.min(t,100)},sort(e){return[...e].sort((e,t)=>this.getUrgencyScore(t)-this.getUrgencyScore(e))},getSortedPriorities(){return this.sort(getPriorities())},getSortedTasks(){return this.sort(getTasks())},getSortedMeetings(){return this.sort(getMeetings())},getTodaysUrgent(){return[...getPriorities().map(e=>({...e,type:"priority"})),...getTasks().map(e=>({...e,type:"task"})),...getMeetings().map(e=>({...e,type:"meeting"}))].map(e=>({...e,urgencyScore:this.getUrgencyScore(e)})).filter(e=>e.urgencyScore>=50).sort((e,t)=>t.urgencyScore-e.urgencyScore)}};

const Constellation={defaultNodes:[{id:"serena",name:"Serena",role:"Grounding Wire",type:"grounding",status:"active",lastContact:new Date(Date.now()-6048e5).toISOString(),notes:"Brings you back to center. Call when overwhelmed.",connectionStrength:10,avatar:"üåô"},{id:"flora",name:"Flora",role:"Anchor to Present",type:"anchor",status:"active",lastContact:new Date(Date.now()-2592e5).toISOString(),notes:"Connects you to the physical world.",connectionStrength:9,avatar:"üå∏"},{id:"alex",name:"Alex",role:"Restricted Node",type:"trigger",status:"caution",lastContact:new Date(Date.now()-3888e6).toISOString(),notes:"Triggers system drain. Limit contact.",connectionStrength:3,avatar:"‚ö†Ô∏è"}],init(){S.get("po_constellation")||S.set("po_constellation",this.defaultNodes)},getNodes(){return S.get("po_constellation",this.defaultNodes)},saveNodes(e){S.set("po_constellation",e)},getNode(e){return this.getNodes().find(t=>t.id===e)},updateNode(e,t){let a=this.getNodes(),n=a.findIndex(t=>t.id===e);-1!==n&&(a[n]={...a[n],...t},this.saveNodes(a))},logContact(e){this.updateNode(e,{lastContact:new Date().toISOString(),status:"active"}),logAct("üë•","system",`Logged contact with ${this.getNode(e)?.name}`),toast(`Contact with ${this.getNode(e)?.name} logged`)},addNode(e){let t=this.getNodes();e.id=e.id||"node_"+Date.now(),e.lastContact=e.lastContact||new Date().toISOString(),t.push(e),this.saveNodes(t),logAct("‚ú®","system",`Added constellation node: ${e.name}`)},deleteNode(e){this.saveNodes(this.getNodes().filter(t=>t.id!==e))},getStaleNodes(e=30){let t=new Date(Date.now()-864e5*e);return this.getNodes().filter(e=>new Date(e.lastContact)<t)},getDaysSinceContact(e){return Math.floor((Date.now()-new Date(e.lastContact))/864e5)},getTypeColor(e){return{grounding:"var(--success)",anchor:"var(--info)",trigger:"var(--danger)",neutral:"var(--text-muted)"}[e]||"var(--text-muted)"},getStatusIcon(e){return{active:"üü¢",dormant:"‚ö™",caution:"üü°"}[e]||"‚ö™"}};function getConstellation(){return Constellation.init(),Constellation.getNodes()}function openConstellationPanel(e){let t=Constellation.getNode(e);if(!t)return;let a=Constellation.getDaysSinceContact(t),n=a>30;document.getElementById("slidePanelTitle").textContent="‚ú¶ "+t.name,document.getElementById("slidePanelContent").innerHTML=`
    <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem">
      <div style="width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,${Constellation.getTypeColor(t.type)},var(--accent));display:flex;align-items:center;justify-content:center;font-size:1.75rem">${t.avatar}</div>
      <div><h2 style="margin:0;font-size:1.25rem">${t.name}</h2><p style="color:var(--text-muted);margin:0">${t.role}</p></div>
    </div>
    <div style="margin-bottom:1rem"><span style="font-size:.75rem;text-transform:uppercase;color:var(--text-muted)">Status</span><div style="display:flex;align-items:center;gap:.5rem;margin-top:.25rem"><span>${Constellation.getStatusIcon(t.status)}</span><span style="${n?"color:var(--danger);":""}">${t.status}${n?" (stale - "+a+" days)":""}</span></div></div>
    <div style="margin-bottom:1rem"><span style="font-size:.75rem;text-transform:uppercase;color:var(--text-muted)">Connection Strength</span><div style="margin-top:.25rem;font-size:1.5rem">${"‚òÖ".repeat(t.connectionStrength)}${"‚òÜ".repeat(10-t.connectionStrength)}</div></div>
    <div style="margin-bottom:1rem"><span style="font-size:.75rem;text-transform:uppercase;color:var(--text-muted)">Last Contact</span><div style="margin-top:.25rem">${new Date(t.lastContact).toLocaleDateString()} (${a} days ago)</div></div>
    <div style="margin-bottom:1.5rem"><span style="font-size:.75rem;text-transform:uppercase;color:var(--text-muted)">Notes</span><p style="margin-top:.25rem;color:var(--text-secondary);font-size:.9rem">${t.notes||"No notes"}</p></div>
    <button class="btn btn-primary" style="width:100%;margin-bottom:.5rem" onclick="Constellation.logContact('${t.id}');closeSlidePanel();">üìÖ Log Contact</button>
    <button class="btn btn-ghost" style="width:100%" onclick="editConstellationNode('${t.id}')">‚úèÔ∏è Edit Node</button>
  `,document.getElementById("slidePanel").classList.add("open"),document.getElementById("slideOverlay").classList.add("open")}function editConstellationNode(e){let t=Constellation.getNode(e);t&&(closeSlidePanel(),openModal(`<div class="modal-header"><h3 class="modal-title">Edit Node</h3><button class="modal-close" onclick="closeModal()">√ó</button></div><input class="modal-input" id="nodeName" value="${t.name}" placeholder="Name"><input class="modal-input" id="nodeRole" value="${t.role}" placeholder="Role"><select class="modal-input modal-select" id="nodeType"><option value="grounding" ${"grounding"===t.type?"selected":""}>Grounding</option><option value="anchor" ${"anchor"===t.type?"selected":""}>Anchor</option><option value="trigger" ${"trigger"===t.type?"selected":""}>Trigger</option><option value="neutral" ${"neutral"===t.type?"selected":""}>Neutral</option></select><select class="modal-input modal-select" id="nodeStatus"><option value="active" ${"active"===t.status?"selected":""}>Active</option><option value="dormant" ${"dormant"===t.status?"selected":""}>Dormant</option><option value="caution" ${"caution"===t.status?"selected":""}>Caution</option></select><textarea class="modal-input textarea" id="nodeNotes" placeholder="Notes">${t.notes}</textarea><div class="modal-actions"><button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button><button class="modal-btn modal-btn-primary" onclick="saveConstellationNode('${t.id}')">Save</button></div>`))}function saveConstellationNode(e){Constellation.updateNode(e,{name:document.getElementById("nodeName").value,role:document.getElementById("nodeRole").value,type:document.getElementById("nodeType").value,status:document.getElementById("nodeStatus").value,notes:document.getElementById("nodeNotes").value}),closeModal(),renderActiveTab(),toast("Node updated")}function addConstellationNode(){openModal('<div class="modal-header"><h3 class="modal-title">Add Network Node</h3><button class="modal-close" onclick="closeModal()">√ó</button></div><input class="modal-input" id="newNodeName" placeholder="Name" autofocus><input class="modal-input" id="newNodeRole" placeholder="Role (e.g., Friend, Mentor)"><select class="modal-input modal-select" id="newNodeType"><option value="grounding">Grounding</option><option value="anchor">Anchor</option><option value="trigger">Trigger</option><option value="neutral">Neutral</option></select><textarea class="modal-input textarea" id="newNodeNotes" placeholder="Notes about this connection..."></textarea><div class="modal-actions"><button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button><button class="modal-btn modal-btn-primary" onclick="saveNewConstellationNode()">Add</button></div>')}function saveNewConstellationNode(){let e=document.getElementById("newNodeName").value.trim();e?(Constellation.addNode({name:e,role:document.getElementById("newNodeRole").value||"Connection",type:document.getElementById("newNodeType").value,status:"active",notes:document.getElementById("newNodeNotes").value,connectionStrength:5,avatar:"üë§"}),closeModal(),renderActiveTab(),toast("Node added")):toast("Enter a name","error")}

const BrainSync={syncQueue:[],syncInterval:null,lastSync:null,init(){this.syncQueue=S.get("po_sync_queue",[]),this.lastSync=S.get("po_last_sync",null),this.startAutoSync()},startAutoSync(){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval(()=>this.processQueue(),3e4)},async syncFile(e,t){let a={id:"sync_"+Date.now(),path:e,content:t,timestamp:new Date().toISOString(),status:"pending"};this.syncQueue.push(a),S.set("po_sync_queue",this.syncQueue);try{await this.simulateApiCall("sync",{path:e,content:t}),a.status="synced",this.lastSync=new Date().toISOString(),S.set("po_last_sync",this.lastSync),logAct("üß†","system",`Synced: ${e}`);return{success:!0,path:e}}catch(n){return a.status="failed",logAct("‚ùå","system",`Sync failed: ${e}`),{success:!1,error:n.message}}},async getFile(e){try{let t=await this.simulateApiCall("get",{path:e});return{success:!0,content:t.content,path:e}}catch(t){return{success:!1,error:t.message}}},async listFiles(){return{success:!0,files:[{path:"memory/2025-02-22.md",lastModified:Date.now()-36e5},{path:"USER.md",lastModified:Date.now()-1728e5},{path:"AGENTS.md",lastModified:Date.now()-2592e5},{path:"MEMORY.md",lastModified:Date.now()-3456e5}]}},watchFile(e,t){let a=setInterval(async()=>{let a=await this.getFile(e);a.success&&t(a.content)},6e4);return{stop:()=>clearInterval(a)}},async processQueue(){for(let e of this.syncQueue.filter(e=>"pending"===e.status))await this.syncFile(e.path,e.content)},async syncAll(){toast("Starting Brain Sync...");for(let e of["memory/2025-02-22.md","USER.md","AGENTS.md","MEMORY.md"])await this.syncFile(e,"");toast("Brain Sync complete"),logAct("üß†","system","Full brain sync completed")},simulateApiCall(e,t){return new Promise((e,a)=>{setTimeout(()=>{Math.random()>.1?e({success:!0,...t,synced:!0}):a(Error("Network error"))},500)})},getSyncStatus(){return{lastSync:this.lastSync,pendingCount:this.syncQueue.filter(e=>"pending"===e.status).length,failedCount:this.syncQueue.filter(e=>"failed"===e.status).length,isOnline:navigator.onLine}}};

const SorayaBridge={activeAgents:[],agentHistory:[],init(){this.activeAgents=S.get("po_active_agents",[]),this.agentHistory=S.get("po_agent_history",[])},async spawnAgent(e,t="scribe"){let a={scribe:{name:"The Scribe",icon:"‚úçÔ∏è",model:"Claude Sonnet 4.6"},mechanic:{name:"The Mechanic",icon:"üîß",model:"Trinity Large"},analyst:{name:"The Cartographer",icon:"üó∫Ô∏è",model:"Gemini 3 Flash"},researcher:{name:"The Researcher",icon:"üîç",model:"Kimi K2.5"}}[t]||{name:"Agent",icon:"ü§ñ",model:"Unknown"},n={id:"agent_"+Date.now(),type:t,name:a.name,icon:a.icon,model:a.model,task:e.substring(0,100),status:"running",createdAt:new Date().toISOString(),progress:0};return this.activeAgents.push(n),S.set("po_active_agents",this.activeAgents),logAct(a.icon,"system",`Spawned ${a.name}: ${e.substring(0,40)}...`),this.simulateAgentExecution(n),n},simulateAgentExecution(e){let t=setInterval(()=>{e.progress+=20*Math.random(),e.progress>=100&&(e.progress=100,e.status="completed",e.completedAt=new Date().toISOString(),this.moveToHistory(e),clearInterval(t),logAct(e.icon,"system",`${e.name} completed task`)),S.set("po_active_agents",this.activeAgents)},2e3)},moveToHistory(e){this.activeAgents=this.activeAgents.filter(t=>t.id!==e.id),this.agentHistory.unshift(e),this.agentHistory.length>50&&this.agentHistory.pop(),S.set("po_active_agents",this.activeAgents),S.set("po_agent_history",this.agentHistory)},listActiveAgents(){return this.activeAgents},getAgentStatus(e){return this.activeAgents.find(t=>t.id===e)||this.agentHistory.find(t=>t.id===e)},killAgent(e){let t=this.activeAgents.find(t=>t.id===e);return t?(t.status="killed",this.moveToHistory(t),logAct("üõë","system",`Killed agent: ${t.name}`),!0):!1},getAgentStats(){return{active:this.activeAgents.length,running:this.activeAgents.filter(e=>"running"===e.status).length,completed:this.agentHistory.filter(e=>"completed"===e.status).length,killed:this.agentHistory.filter(e=>"killed"===e.status).length}}};

function approveDecision(e){let t=getDecisions().find(t=>t.id===e);if(!t)return;let a=t.agents&&t.agents.includes("Mechanic")?"mechanic":t.agents&&t.agents.includes("Cartographer")?"analyst":"scribe";SorayaBridge.spawnAgent(`Execute decision: ${t.question}`,a),toast(`Agent spawned for: ${t.question.substring(0,30)}...`),logAct("‚úÖ","system",`Approved decision: ${t.question.substring(0,40)}`)}

const GoogleCalendar={isAuthenticated:!1,accessToken:null,events:[],lastFetch:null,init(){this.accessToken=S.get("po_gcal_token",null),this.events=S.get("po_gcal_events",[]),this.lastFetch=S.get("po_gcal_last_fetch",null),this.isAuthenticated=!!this.accessToken},async authenticate(){openModal('<div class="modal-header"><h3 class="modal-title">Connect Google Calendar</h3><button class="modal-close" onclick="closeModal()">√ó</button></div><p style="color:var(--text-secondary);margin-bottom:1rem;">Enter your Google Calendar API key:</p><input type="text" class="modal-input" id="gcalApiKey" placeholder="AIzaSy..."><div class="modal-actions"><button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button><button class="modal-btn modal-btn-primary" onclick="GoogleCalendar.saveAuth()">Connect</button></div>')},saveAuth(){let e=document.getElementById("gcalApiKey").value.trim();e&&(S.set("po_gcal_token",e),this.accessToken=e,this.isAuthenticated=!0,closeModal(),toast("Google Calendar connected"),logAct("üìÖ","system","Connected Google Calendar"))},async fetchEvents(e=7){if(!this.isAuthenticated){toast("Connect Google Calendar first","error");return[]}try{let t=this.generateMockEvents(e);return this.events=t,S.set("po_gcal_events",t),this.lastFetch=new Date().toISOString(),S.set("po_gcal_last_fetch",this.lastFetch),t}catch(t){return toast("Failed to fetch events","error"),[]}},generateMockEvents(e){let t=[],a=new Date;for(let n=0;n<e;n++){let s=new Date(a);if(s.setDate(s.getDate()+n),Math.random()>.3){let a=9+Math.floor(8*Math.random()),i=a+1;t.push({id:"evt_"+Date.now()+"_"+n,summary:["Hamilton Library Interview","Firebird Grant Review","OPLA Meeting","Therapy","Gym","Groceries"][Math.floor(6*Math.random())],start:{dateTime:new Date(s.setHours(a,0,0,0)).toISOString()},end:{dateTime:new Date(s.setHours(i,0,0,0)).toISOString()},description:"Auto-generated event"})}}return t},getTodayEvents(){let e=new Date,t=e.toISOString().split("T")[0];return this.events.filter(e=>e.start.dateTime&&e.start.dateTime.startsWith(t))},getUpcomingEvents(e=7){let t=new Date;return this.events.filter(a=>new Date(a.start.dateTime)>t).slice(0,e)},async createEvent(e){if(!this.isAuthenticated)return{success:!1,error:"Not authenticated"};this.events.push({...e,id:"evt_"+Date.now()}),S.set("po_gcal_events",this.events);return{success:!0}},getEventsForDate(e){return this.events.filter(t=>t.start.dateTime&&t.start.dateTime.startsWith(e))}};

const MorningReport={async generate(){let e=GoogleCalendar.getTodayEvents(),t=SmartSort.getTodaysUrgent();return{date:new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),events:e,urgentItems:t,focusAreas:t.length>0?t.slice(0,3).map(e=>e.title||e.text||e.summary):["No urgent items"],preparedAt:new Date().toISOString()}},renderDashboardCard(){let e=this.generate();return`
      <div class="card" style="margin-bottom:1.5rem;border-left:3px solid var(--accent);">
        <div class="card-header">
          <span class="card-title">üåÖ Morning Report</span>
          <span style="font-size:.75rem;color:var(--text-muted)">${e.date}</span>
        </div>
        <div style="padding:0 0 1rem 0;">
          ${e.events.length>0?`<div style="margin-bottom:1rem;"><div style="font-size:.75rem;text-transform:uppercase;color:var(--text-muted);margin-bottom:.5rem;">Today's Schedule</div>${e.events.map(e=>`<div style="display:flex;align-items:center;gap:.5rem;padding:.5rem;background:rgba(212,168,75,.08);border-radius:6px;margin-bottom:.375rem;"><span>üìÖ</span><span style="font-weight:500;">${e.summary}</span><span style="margin-left:auto;font-size:.75rem;color:var(--text-muted);">${new Date(e.start.dateTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}</span></div>`).join("")}</div>`:'<div style="padding:1rem;text-align:center;color:var(--text-muted);">No events today</div>'}
          ${e.urgentItems.length>0?`<div><div style="font-size:.75rem;text-transform:uppercase;color:var(--text-muted);margin-bottom:.5rem;">Requires Attention</div>${e.urgentItems.slice(0,3).map(e=>`<div style="display:flex;align-items:center;gap:.5rem;padding:.375rem 0;color:var(--danger);"><span>üî•</span><span>${e.title||e.text||e.summary}</span></div>`).join("")}</div>`:""}
        </div>
      </div>
    `}};console.log("[Pleiades OS] Functional Upgrades Module Loaded");